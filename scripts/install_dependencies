#!/bin/bash

# Exit on any error
set -e

echo "Updating package repository..."
sudo yum update -y

echo "Installing required dependencies..."
sudo yum install -y java-17-amazon-corretto wget unzip

echo "Verifying Java installation..."
java -version

TOMCAT_VERSION="10.1.34"
TOMCAT_DOWNLOAD_URL="https://dlcdn.apache.org/tomcat/tomcat-10/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz"
TOMCAT_INSTALL_DIR="/opt/tomcat"

echo "Downloading Tomcat version $TOMCAT_VERSION..."
wget -q $TOMCAT_DOWNLOAD_URL -O /tmp/apache-tomcat-$TOMCAT_VERSION.tar.gz

echo "Creating Tomcat installation directory..."
sudo mkdir -p $TOMCAT_INSTALL_DIR

echo "Extracting Tomcat..."
sudo tar -xzf /tmp/apache-tomcat-$TOMCAT_VERSION.tar.gz -C $TOMCAT_INSTALL_DIR --strip-components=1

echo "Setting permissions for Tomcat files..."
sudo chmod -R +x $TOMCAT_INSTALL_DIR/bin

echo "Cleaning up downloaded files..."
rm -f /tmp/apache-tomcat-$TOMCAT_VERSION.tar.gz

echo "Tomcat $TOMCAT_VERSION installed successfully in $TOMCAT_INSTALL_DIR."
echo "You can start Tomcat using the following command:"
echo "  $TOMCAT_INSTALL_DIR/bin/startup.sh"
